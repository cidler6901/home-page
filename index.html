<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Proxy</title>
<style>
body, html { margin:0; padding:0; height:100%; font-family: Arial,sans-serif; }
#topBar { background:#222; color:white; padding:5px 10px; display:flex; align-items:center; }
#topBar button { margin-left:auto; }
#urlBar { flex:1; margin-left:10px; padding:5px; }
#iframeContainer { width:100%; height:calc(100% - 40px); }
#proxyFrame { width:100%; height:100%; border:none; }
#announcementPopup{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:1000;}
#popupContent{background:white;padding:20px;border-radius:8px;max-width:400px;text-align:center;position:relative;}
#announcementBanner{display:none;position:fixed;top:0;left:0;right:0;background:#ffeb3b;color:#000;padding:10px 20px;font-weight:bold;z-index:1000;}
#bannerClose{position:absolute;right:10px;top:5px;cursor:pointer;font-weight:bold;}
</style>
</head>
<body>

<div id="topBar">
  <input type="text" id="urlBar" placeholder="Enter URL and press Enter">
  <button onclick="toggleTopBar()">Show/Hide Top Bar</button>
</div>

<div id="iframeContainer">
  <iframe id="proxyFrame" src="/api/proxy?url=https://example.com"></iframe>
</div>

<!-- Pop-up -->
<div id="announcementPopup"><div id="popupContent">
  <span id="popupText"></span>
  <div><label><input type="checkbox" id="dontShow"> Don't show for next 5 sessions</label></div>
  <button onclick="closePopup()">Close</button>
</div></div>

<!-- Banner -->
<div id="announcementBanner">
  <span id="bannerText"></span>
  <span id="bannerClose" onclick="closeBanner()">X</span>
</div>

<script>
const iframe=document.getElementById('proxyFrame');
const urlBar=document.getElementById('urlBar');
const topBar=document.getElementById('topBar');

urlBar.addEventListener('keydown', e=>{
  if(e.key==="Enter"){
    iframe.src=`/api/proxy?url=${encodeURIComponent(urlBar.value)}`;
    hideTopBar();
  }
});
function toggleTopBar(){ topBar.style.display = topBar.style.display==='none' ? 'flex':'none'; }
function hideTopBar(){ topBar.style.display='none'; }
function getSessionCount(){ return parseInt(localStorage.getItem('announcementSessions')||'0'); }
function incrementSessionCount(){ localStorage.setItem('announcementSessions',getSessionCount()+1); }
function resetSessionCount(){ localStorage.setItem('announcementSessions','0'); }

fetch("/api/announcement").then(r=>r.json()).then(data=>{
  if(!data.enabled) return;
  const lastSHA=localStorage.getItem('announcementSHA');
  if(lastSHA!==data.sha){ resetSessionCount(); localStorage.setItem('announcementSHA',data.sha); }
  if(getSessionCount()<5) showPopup(data.announcement);
  showBanner(data.announcement);
});
function showPopup(t){document.getElementById('popupText').innerText=t;document.getElementById('announcementPopup').style.display='flex';}
function closePopup(){if(document.getElementById('dontShow').checked)localStorage.setItem('announcementSessions','5');document.getElementById('announcementPopup').style.display='none';incrementSessionCount();}
function showBanner(t){document.getElementById('announcementBanner').style.display='block';document.getElementById('bannerText').innerText=t;}
function closeBanner(){document.getElementById('announcementBanner').style.display='none';}
</script>
</body>
</html>
