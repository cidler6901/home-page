<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Proxy</title>
<style>
html, body { margin:0; padding:0; height:100%; font-family:'Segoe UI',sans-serif; background:#f0f2f5; overflow:hidden; }
header { background: linear-gradient(90deg,#6200ea,#03dac6); color:white; padding:15px; text-align:center; z-index:100; position:relative; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:1.8em; }

/* Show/Hide toggle button */
#toggleControlsBtn {
  padding:8px 12px;
  border:none;
  border-radius:15px;
  background:#03dac6;
  color:white;
  font-size:14px;
  cursor:pointer;
}

/* Announcement banner */
#announcementBanner {
  display:none;
  background:#ffeb3b; 
  color:#333; 
  padding:10px 20px; 
  text-align:center; 
  font-weight:bold;
  position:relative;
  z-index:100;
}
#announcementBanner button {
  position:absolute;
  right:10px;
  top:5px;
  border:none;
  background:none;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
  color:#333;
}

/* Announcement modal */
#announcementModal {
  display:none; 
  position:fixed; 
  z-index:1000; 
  top:0; left:0; 
  width:100%; height:100%; 
  background: rgba(0,0,0,0.5);
}
#announcementModal .modal-content {
  background:#fff; 
  margin:15% auto; 
  padding:20px; 
  width:80%; 
  max-width:400px; 
  border-radius:15px; 
  text-align:center; 
  box-shadow:0 4px 8px rgba(0,0,0,0.2);
}
#announcementModal button { padding:10px 20px; border:none; background:#6200ea; color:white; border-radius:10px; cursor:pointer; margin-top:10px; }
#announcementModal label { display:block; margin-top:10px; cursor:pointer; font-size:14px; }

/* Controls */
#controlsContainer {
  position: absolute;
  top:70px; 
  left:50%; 
  transform:translateX(-50%);
  display:flex;
  flex-direction:column;
  gap:10px;
  background:rgba(255,255,255,0.9);
  padding:10px 15px;
  border-radius:20px;
  z-index:100;
}
#controls { display:flex; gap:10px; }
#controls input {
  padding:10px 15px;
  border-radius:20px;
  border:1px solid #ccc;
  font-size:16px;
  width:300px;
  outline:none;
}
#controls button {
  padding:10px 20px;
  border-radius:20px;
  border:none;
  background:#6200ea;
  color:white;
  font-size:16px;
  cursor:pointer;
}

/* Quick links */
#quickLinks { display:flex; gap:10px; flex-wrap:wrap; }
#quickLinks button {
  padding:10px 15px;
  border-radius:20px;
  border:none;
  background:#03dac6;
  color:#fff;
  font-size:14px;
  cursor:pointer;
}

/* Fullscreen iframe */
#proxyFrame {
  position:absolute;
  top:0; left:0;
  width:100%;
  border:none;
  z-index:1;
}
</style>
</head>
<body>

<header>
<h1>Full-Screen Proxy</h1>
<button id="toggleControlsBtn" onclick="toggleControls()">Show Controls</button>
</header>

<!-- Announcement banner -->
<div id="announcementBanner">
  <span id="bannerText"></span>
  <button onclick="closeBanner()">X</button>
</div>

<!-- Announcement modal -->
<div id="announcementModal">
  <div class="modal-content">
    <p id="modalText"></p>
    <label><input type="checkbox" id="skipNextSessions"> Don't show for next 5 sessions</label>
    <button onclick="closeModal()">Close</button>
  </div>
</div>

<!-- Controls + Quick links -->
<div id="controlsContainer">
  <div id="controls">
    <input type="text" id="urlInput" placeholder="Enter website URL">
    <button onclick="loadSite()">Go</button>
  </div>
  <div id="quickLinks">
    <button onclick="loadSiteURL('https://ubg6.neocities.org/games/Eaglecraft')">Minecraft</button>
    <button onclick="loadSiteURL('http://ubg6.cidler6901.workers.dev/')">US4</button>
    <button onclick="loadSiteURL('http://ubg1.cidler6901.workers.dev/')">US5</button>
    <button onclick="loadSiteURL('https://takaiwebsite.neocities.org/minecraft')">Minecraft 2</button>
    <button onclick="loadSiteURL('https://jblaha.art/sketchbook/')">Sketchbook</button>
  </div>
</div>

<!-- Proxy iframe -->
<iframe id="proxyFrame" src=""></iframe>

<script>
// Announcement
function loadAnnouncement(){
  fetch('https://raw.githubusercontent.com/cidler6901/proxy/main/announcement.json')
  .then(res=>res.json())
  .then(data=>{
    if(!data.enabled || !data.announcement.trim()) return;

    const currentVersion = data.announcementVersion || 1;
    const sessionData = JSON.parse(localStorage.getItem('announcementSessions') || '{}');
    const userSessions = sessionData[currentVersion] || 0;

    // Show popup only if userSessions < 5
    if(userSessions < 5){
      document.getElementById('modalText').textContent = data.announcement;
      document.getElementById('announcementModal').style.display="block";
    }

    // Banner always shows
    document.getElementById('bannerText').textContent = data.announcement;
    document.getElementById('announcementBanner').style.display="block";

    // Save version
    window.announcementVersion = currentVersion;

    resizeIframe();
  })
  .catch(err=>console.log("No announcement found:", err));
}

function closeModal(){
  const skip = document.getElementById('skipNextSessions').checked;
  if(skip){
    const sessionData = JSON.parse(localStorage.getItem('announcementSessions') || '{}');
    sessionData[window.announcementVersion] = (sessionData[window.announcementVersion] || 0) + 1;
    localStorage.setItem('announcementSessions', JSON.stringify(sessionData));
  }
  document.getElementById('announcementModal').style.display="none";
}

function closeBanner(){
  document.getElementById('announcementBanner').style.display="none";
  resizeIframe();
}

// Proxy
function loadSite(){
  let url = document.getElementById('urlInput').value.trim();
  if(!url) return alert("Please enter a URL");
  if(!url.startsWith("http")) url="https://"+url;
  document.getElementById('proxyFrame').src = "https://api.allorigins.win/raw?url=" + encodeURIComponent(url);

  // Save last URL
  localStorage.setItem('lastURL', url);

  // Hide controls when navigating
  document.getElementById('controlsContainer').style.display = 'none';
  document.getElementById('toggleControlsBtn').style.display = 'inline-block';

  resizeIframe();
}

// Quick links
function loadSiteURL(url){
  document.getElementById('proxyFrame').src = "https://api.allorigins.win/raw?url=" + encodeURIComponent(url);

  // Save last URL
  localStorage.setItem('lastURL', url);

  document.getElementById('controlsContainer').style.display = 'none';
  document.getElementById('toggleControlsBtn').style.display = 'inline-block';

  resizeIframe();
}

// Toggle controls visibility
function toggleControls(){
  const container = document.getElementById('controlsContainer');
  if(container.style.display === 'none' || container.style.display === ''){
    container.style.display = 'flex';
    document.getElementById('toggleControlsBtn').style.display = 'none';
  } else {
    container.style.display = 'none';
    document.getElementById('toggleControlsBtn').style.display = 'inline-block';
  }

  resizeIframe();
}

// Resize iframe dynamically
function resizeIframe(){
  const iframe = document.getElementById('proxyFrame');
  const headerHeight = document.querySelector('header').offsetHeight;
  const banner = document.getElementById('announcementBanner');
  const bannerHeight = banner.style.display !== 'none' ? banner.offsetHeight : 0;
  const controls = document.getElementById('controlsContainer');
  const controlsHeight = controls.style.display !== 'none' ? controls.offsetHeight : 0;

  iframe.style.top = (headerHeight + bannerHeight + controlsHeight) + 'px';
  iframe.style.height = (window.innerHeight - headerHeight - bannerHeight - controlsHeight) + 'px';
}

// Resize on window resize
window.addEventListener('resize', resizeIframe);

// Load last URL if exists
window.addEventListener('load', ()=>{
  const lastURL = localStorage.getItem('lastURL');
  if(lastURL){
    document.getElementById('proxyFrame').src = "https://api.allorigins.win/raw?url=" + encodeURIComponent(lastURL);
    document.getElementById('controlsContainer').style.display = 'none';
    document.getElementById('toggleControlsBtn').style.display = 'inline-block';
  }
  loadAnnouncement();
});
</script>

</body>
</html>
