<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Announcements</title>
<style>
body{font-family:Arial,sans-serif;padding:20px;background:#f0f2f5;}
input,textarea,button{display:block;width:100%;margin:10px 0;padding:10px;font-size:16px;}
textarea{height:150px;}
.login{max-width:400px;margin:auto;background:white;padding:20px;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
.hidden{display:none;}
</style>
</head>
<body>

<div class="login" id="loginBox">
<h2>Admin Login</h2>
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div class="hidden" id="editorBox">
<h2>Edit Announcement</h2>
<textarea id="announcementText"></textarea>
<label><input type="checkbox" id="announcementEnabled"> Enable Announcement</label>
<button onclick="saveAnnouncement()">Save Announcement</button>
<button onclick="removeAnnouncement()" style="background:red;color:white;">Remove Announcement</button>
<p style="font-size:14px;color:#555;">Changes update announcement.json via GitHub API.</p>
</div>

<script>
// Admin login
const ADMIN_USER="admin"; // your admin username
const ADMIN_PASS="ci259026901"; // your admin password

// GitHub API details
const GITHUB_USER="cidler6901"; // your GitHub username
const GITHUB_REPO="proxy";      // your repository
const FILE_PATH="announcement.json"; // file to edit
const BRANCH="main";
const TOKEN="Y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"; // replace with your GitHub PAT

// Login
function login(){
  const u=document.getElementById('username').value;
  const p=document.getElementById('password').value;
  if(u===ADMIN_USER && p===ADMIN_PASS){
    document.getElementById('loginBox').classList.add('hidden');
    document.getElementById('editorBox').classList.remove('hidden');
    loadCurrentAnnouncement();
  } else alert("Incorrect username/password!");
}

// Load current announcement
function loadCurrentAnnouncement(){
  fetch(`https://api.github.com/repos/${cidler6901}/${proxy}/contents/${announcement.json}?ref=${nain}`)
  .then(res=>res.json())
  .then(data=>{
    const content = atob(data.content);
    const json = JSON.parse(content);
    document.getElementById('announcementText').value = json.announcement;
    document.getElementById('announcementEnabled').checked = json.enabled || false;
    window.currentSHA = data.sha;
  })
  .catch(()=>{ 
    document.getElementById('announcementText').value="";
    document.getElementById('announcementEnabled').checked=false;
  });
}

// Save announcement
function saveAnnouncement(){
  const text = document.getElementById('announcementText').value.trim();
  const enabled = document.getElementById('announcementEnabled').checked;
  if(!text) return alert("Announcement cannot be empty!");
  updateFileOnGitHub({announcement:text, enabled:enabled});
}

// Remove announcement
function removeAnnouncement(){
  if(confirm("Are you sure you want to remove the announcement?")){
    updateFileOnGitHub({announcement:"", enabled:false});
  }
}

// Update GitHub file
function updateFileOnGitHub(obj){
  const message = obj.enabled ? "Update announcement" : "Remove announcement";
  const content = btoa(JSON.stringify(obj));
  fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${FILE_PATH}`, {
    method: "PUT",
    headers: {
      "Authorization": `token ${TOKEN}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({message, content, sha: window.currentSHA, branch: BRANCH})
  })
  .then(res=>res.json())
  .then(data=>{
    alert("Announcement updated successfully!");
    loadCurrentAnnouncement();
  })
  .catch(err=>alert("Error updating announcement: "+err));
}
</script>

</body>
</html>
